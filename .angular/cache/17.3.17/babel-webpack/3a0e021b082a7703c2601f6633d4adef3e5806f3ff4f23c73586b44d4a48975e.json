{"ast":null,"code":"import { Subject, takeUntil } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/gasolineras.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"../tarjeta-gasolinera/tarjeta-gasolinera.component\";\nimport * as i4 from \"../filtros/filtros.component\";\nfunction ListaGasolinerasComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 7)(1, \"app-filtros\", 8);\n    i0.ɵɵlistener(\"filtrosChange\", function ListaGasolinerasComponent_div_1_Template_app_filtros_filtrosChange_1_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onFiltrosChange($event));\n    })(\"buscarCercanas\", function ListaGasolinerasComponent_div_1_Template_app_filtros_buscarCercanas_1_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.buscarCercanas());\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"div\", 9)(3, \"h2\");\n    i0.ɵɵtext(4, \"Gasolineras disponibles\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"button\", 10);\n    i0.ɵɵlistener(\"click\", function ListaGasolinerasComponent_div_1_Template_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.refrescar());\n    });\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"provincias\", ctx_r1.provincias)(\"localidades\", ctx_r1.localidades)(\"todasLasGasolineras\", ctx_r1.gasolineras);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"disabled\", ctx_r1.loading);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \\uD83D\\uDD04 \", ctx_r1.loading ? \"Cargando...\" : \"Actualizar\", \" \");\n  }\n}\nfunction ListaGasolinerasComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11);\n    i0.ɵɵelement(1, \"div\", 12);\n    i0.ɵɵelementStart(2, \"p\");\n    i0.ɵɵtext(3, \"Cargando datos del MITECO...\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction ListaGasolinerasComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 13);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.error, \" \");\n  }\n}\nfunction ListaGasolinerasComponent_div_5_app_tarjeta_gasolinera_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-tarjeta-gasolinera\", 19);\n  }\n  if (rf & 2) {\n    const gasolinera_r3 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"gasolinera\", gasolinera_r3)(\"combustibleDestacado\", ctx_r1.filtros.tipoCombustible);\n  }\n}\nfunction ListaGasolinerasComponent_div_5_p_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 20);\n    i0.ɵɵtext(1, \" Mostrando las 50 gasolineras m\\u00E1s baratas. Usa los filtros para refinar la b\\u00FAsqueda. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ListaGasolinerasComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 14)(1, \"p\", 15);\n    i0.ɵɵtext(2, \" Se encontraron \");\n    i0.ɵɵelementStart(3, \"strong\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(5, \" gasolineras \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"div\", 16);\n    i0.ɵɵtemplate(7, ListaGasolinerasComponent_div_5_app_tarjeta_gasolinera_7_Template, 1, 2, \"app-tarjeta-gasolinera\", 17);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(8, ListaGasolinerasComponent_div_5_p_8_Template, 2, 0, \"p\", 18);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(ctx_r1.gasolinerasFiltradas.length);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.gasolinerasFiltradas.slice(0, 50))(\"ngForTrackBy\", ctx_r1.trackByFn);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.gasolinerasFiltradas.length > 50);\n  }\n}\nfunction ListaGasolinerasComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 21);\n    i0.ɵɵtext(1, \" No se encontraron gasolineras. \");\n    i0.ɵɵelementEnd();\n  }\n}\nexport let ListaGasolinerasComponent = /*#__PURE__*/(() => {\n  class ListaGasolinerasComponent {\n    constructor(gasolinerasService) {\n      this.gasolinerasService = gasolinerasService;\n      this.gasolineras = [];\n      this.gasolinerasFiltradas = [];\n      this.provincias = [];\n      this.localidades = [];\n      this.loading = true;\n      this.error = null;\n      this.ubicacionUsuario = null;\n      this.mostrandoCercanas = false;\n      this.filtros = {\n        provincia: '',\n        localidad: '',\n        codigoPostal: '',\n        tipoCombustible: 'diesel'\n      };\n      this.nombresCombustibles = {\n        gasolina95: 'Gasolina 95',\n        gasolina98: 'Gasolina 98',\n        diesel: 'Diésel',\n        dieselPremium: 'Diésel Premium',\n        glp: 'GLP',\n        gnc: 'GNC',\n        bioetanol: 'Bioetanol',\n        biodiesel: 'Biodiésel'\n      };\n      this.destroy$ = new Subject();\n    }\n    ngOnInit() {\n      this.cargarGasolineras();\n    }\n    ngOnDestroy() {\n      this.destroy$.next();\n      this.destroy$.complete();\n    }\n    cargarGasolineras() {\n      this.loading = true;\n      this.error = null;\n      this.gasolinerasService.obtenerGasolineras().pipe(takeUntil(this.destroy$)).subscribe({\n        next: gasolineras => {\n          this.gasolineras = gasolineras;\n          this.extraerProvinciasYLocalidades();\n          this.aplicarFiltros();\n          this.loading = false;\n        },\n        error: err => {\n          console.error('Error al cargar gasolineras:', err);\n          this.error = 'Error al cargar los datos. Por favor, intenta de nuevo más tarde.';\n          this.loading = false;\n        }\n      });\n    }\n    extraerProvinciasYLocalidades() {\n      const provinciasSet = new Set();\n      const localidadesSet = new Set();\n      this.gasolineras.forEach(g => {\n        if (g.provincia) provinciasSet.add(g.provincia);\n        if (g.localidad) localidadesSet.add(g.localidad);\n      });\n      this.provincias = Array.from(provinciasSet).sort();\n      this.localidades = Array.from(localidadesSet).sort();\n    }\n    aplicarFiltros() {\n      let resultado = [...this.gasolineras];\n      if (this.filtros.provincia) {\n        resultado = resultado.filter(g => g.provincia.toLowerCase().includes(this.filtros.provincia.toLowerCase()));\n      }\n      if (this.filtros.localidad) {\n        resultado = resultado.filter(g => g.localidad.toLowerCase().includes(this.filtros.localidad.toLowerCase()));\n      }\n      if (this.filtros.codigoPostal) {\n        resultado = resultado.filter(g => g.codigoPostal.includes(this.filtros.codigoPostal));\n      }\n      // Ordenar por precio del combustible seleccionado\n      resultado = resultado.sort((a, b) => {\n        const precioA = a.precios[this.filtros.tipoCombustible] || Infinity;\n        const precioB = b.precios[this.filtros.tipoCombustible] || Infinity;\n        return precioA - precioB;\n      });\n      this.gasolinerasFiltradas = resultado;\n    }\n    onFiltrosChange(filtros) {\n      this.filtros = {\n        ...this.filtros,\n        ...filtros\n      };\n      this.mostrandoCercanas = false;\n      this.aplicarFiltros();\n    }\n    buscarCercanas() {\n      if (!navigator.geolocation) {\n        this.error = 'Tu navegador no soporta geolocalización.';\n        return;\n      }\n      this.loading = true;\n      this.error = null;\n      navigator.geolocation.getCurrentPosition(position => {\n        this.ubicacionUsuario = {\n          lat: position.coords.latitude,\n          lng: position.coords.longitude\n        };\n        this.mostrarGasolinerasCercanas();\n        this.loading = false;\n      }, error => {\n        this.loading = false;\n        if (error.code === error.PERMISSION_DENIED) {\n          this.error = 'Debes permitir el acceso a tu ubicación para encontrar gasolineras cercanas.';\n        } else {\n          this.error = 'No se pudo obtener tu ubicación. Por favor, intenta de nuevo.';\n        }\n        console.error('Error de geolocalización:', error);\n      }, {\n        enableHighAccuracy: true,\n        timeout: 10000,\n        maximumAge: 0\n      });\n    }\n    mostrarGasolinerasCercanas() {\n      if (!this.ubicacionUsuario) return;\n      this.mostrandoCercanas = true;\n      const gasolinerasConDistancia = this.gasolineras.map(g => ({\n        ...g,\n        distancia: this.calcularDistancia(this.ubicacionUsuario.lat, this.ubicacionUsuario.lng, g.latitud, g.longitud)\n      })).sort((a, b) => a.distancia - b.distancia);\n      this.gasolinerasFiltradas = gasolinerasConDistancia;\n    }\n    calcularDistancia(lat1, lon1, lat2, lon2) {\n      // Fórmula de Haversine para calcular distancia entre dos puntos en la Tierra\n      const R = 6371; // Radio de la Tierra en kilómetros\n      const dLat = this.toRadians(lat2 - lat1);\n      const dLon = this.toRadians(lon2 - lon1);\n      const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(this.toRadians(lat1)) * Math.cos(this.toRadians(lat2)) * Math.sin(dLon / 2) * Math.sin(dLon / 2);\n      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n      const distancia = R * c; // Distancia en kilómetros\n      return distancia;\n    }\n    toRadians(grados) {\n      return grados * (Math.PI / 180);\n    }\n    refrescar() {\n      this.gasolinerasService.refrescar();\n      this.cargarGasolineras();\n    }\n    trackByFn(index, item) {\n      return item.id;\n    }\n    static {\n      this.ɵfac = function ListaGasolinerasComponent_Factory(t) {\n        return new (t || ListaGasolinerasComponent)(i0.ɵɵdirectiveInject(i1.GasolinerasService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ListaGasolinerasComponent,\n        selectors: [[\"app-lista-gasolineras\"]],\n        decls: 7,\n        vars: 5,\n        consts: [[1, \"lista-container\"], [\"class\", \"filtros-sticky\", 4, \"ngIf\"], [1, \"contenido-scrollable\"], [\"class\", \"loading\", 4, \"ngIf\"], [\"class\", \"error\", 4, \"ngIf\"], [\"class\", \"resultados\", 4, \"ngIf\"], [\"class\", \"sin-resultados\", 4, \"ngIf\"], [1, \"filtros-sticky\"], [3, \"filtrosChange\", \"buscarCercanas\", \"provincias\", \"localidades\", \"todasLasGasolineras\"], [1, \"header-lista\"], [1, \"btn-primary\", 3, \"click\", \"disabled\"], [1, \"loading\"], [1, \"spinner\"], [1, \"error\"], [1, \"resultados\"], [1, \"contador\"], [1, \"grid-gasolineras\"], [3, \"gasolinera\", \"combustibleDestacado\", 4, \"ngFor\", \"ngForOf\", \"ngForTrackBy\"], [\"class\", \"aviso-limite\", 4, \"ngIf\"], [3, \"gasolinera\", \"combustibleDestacado\"], [1, \"aviso-limite\"], [1, \"sin-resultados\"]],\n        template: function ListaGasolinerasComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0);\n            i0.ɵɵtemplate(1, ListaGasolinerasComponent_div_1_Template, 7, 5, \"div\", 1);\n            i0.ɵɵelementStart(2, \"div\", 2);\n            i0.ɵɵtemplate(3, ListaGasolinerasComponent_div_3_Template, 4, 0, \"div\", 3)(4, ListaGasolinerasComponent_div_4_Template, 2, 1, \"div\", 4)(5, ListaGasolinerasComponent_div_5_Template, 9, 4, \"div\", 5)(6, ListaGasolinerasComponent_div_6_Template, 2, 0, \"div\", 6);\n            i0.ɵɵelementEnd()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.loading);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngIf\", ctx.loading);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.error && !ctx.loading);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.loading && ctx.gasolinerasFiltradas.length > 0);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.loading && ctx.gasolinerasFiltradas.length === 0);\n          }\n        },\n        dependencies: [i2.NgForOf, i2.NgIf, i3.TarjetaGasolineraComponent, i4.FiltrosComponent],\n        styles: [\".lista-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.filtros-sticky[_ngcontent-%COMP%]{position:sticky;top:0;z-index:100;flex-shrink:0;background-color:#f5f5f5;padding:0 0 10px;box-shadow:0 2px 4px #0000000d}.contenido-scrollable[_ngcontent-%COMP%]{flex:1;padding:20px}.header-lista[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:20px;background-color:#fff;border-bottom:1px solid #e0e0e0}.header-lista[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.3rem}.header-lista[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{height:44px}.loading[_ngcontent-%COMP%]{text-align:center;padding:60px 20px}.loading[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{border:4px solid #f3f3f3;border-top:4px solid #667eea;border-radius:50%;width:50px;height:50px;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:20px auto}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.error[_ngcontent-%COMP%]{margin:20px 0;padding:20px;background-color:#f8d7da;border:1px solid #f5c6cb;border-radius:5px;color:#721c24;text-align:center}.resultados[_ngcontent-%COMP%]   .contador[_ngcontent-%COMP%]{background-color:#fff;padding:15px 20px;border-radius:8px;margin-bottom:20px;box-shadow:0 2px 4px #0000001a}.resultados[_ngcontent-%COMP%]   .contador[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#667eea;font-size:1.2em}.grid-gasolineras[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:20px}.sin-resultados[_ngcontent-%COMP%]{text-align:center;padding:60px 20px;background-color:#fff;border-radius:8px;color:#7f8c8d;font-size:1.1rem}.aviso-limite[_ngcontent-%COMP%]{text-align:center;margin:20px 0;padding:15px;background-color:#fff3cd;border:1px solid #ffc107;border-radius:5px;color:#856404}@media (max-width: 768px){.grid-gasolineras[_ngcontent-%COMP%]{grid-template-columns:1fr}.header-lista[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}}\"]\n      });\n    }\n  }\n  return ListaGasolinerasComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}