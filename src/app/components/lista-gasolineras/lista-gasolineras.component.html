<div class="lista-container">
  <div class="filtros-sticky" *ngIf="!loading">
    <app-filtros 
      (filtrosChange)="onFiltrosChange($event)"
      (buscarCercanas)="buscarCercanas()"
      [provincias]="provincias"
      [localidades]="localidades"
      [todasLasGasolineras]="gasolineras">
    </app-filtros>
    
    <div class="header-lista">
      <h2>Gasolineras disponibles</h2>
      <div class="botones-header">
        <button class="btn-secondary" 
                (click)="mostrarFavoritos = !mostrarFavoritos"
                [class.activo]="mostrarFavoritos">
          â˜… Favoritos ({{ numeroFavoritos }})
        </button>
        <button class="btn-primary" (click)="refrescar()" [disabled]="loading">
          ğŸ”„ {{ loading ? 'Cargando...' : 'Actualizar' }}
        </button>
      </div>
    </div>
  </div>

  <div class="contenido-scrollable">
    <div *ngIf="loading" class="loading">
      <div class="spinner"></div>
      <p>Cargando datos del MITECO...</p>
    </div>

    <div *ngIf="error && !loading" class="error">
      {{ error }}
    </div>

    <div *ngIf="!loading && gasolinerasFiltradas.length > 0" class="resultados">
      <div *ngIf="mostrarFavoritos" class="seccion-favoritos">
        <h3>â­ Mis Favoritos</h3>
        <div *ngIf="favoritos.length === 0" class="sin-favoritos">
          No hay gasolineras en favoritos. Â¡Agrega algunas!
        </div>
        <div *ngIf="favoritos.length > 0" class="grid-gasolineras">
          <app-tarjeta-gasolinera 
            *ngFor="let gasolinera of favoritos; trackBy: trackByFn"
            [gasolinera]="gasolinera"
            [combustibleDestacado]="filtros.tipoCombustible">
          </app-tarjeta-gasolinera>
        </div>
        <button class="btn-limpiar-favoritos" 
                (click)="limpiarFavoritos()"
                *ngIf="favoritos.length > 0">
          ğŸ—‘ï¸ Limpiar favoritos
        </button>
      </div>

      <div *ngIf="!mostrarFavoritos">
        <p class="contador">
          Se encontraron <strong>{{ gasolinerasFiltradas.length }}</strong> gasolineras
        </p>

        <div class="grid-gasolineras">
          <app-tarjeta-gasolinera 
            *ngFor="let gasolinera of gasolinerasFiltradas.slice(0, 50); trackBy: trackByFn"
            [gasolinera]="gasolinera"
            [combustibleDestacado]="filtros.tipoCombustible">
          </app-tarjeta-gasolinera>
        </div>

        <p *ngIf="gasolinerasFiltradas.length > 50" class="aviso-limite">
          Mostrando las 50 gasolineras mÃ¡s baratas. Usa los filtros para refinar la bÃºsqueda.
        </p>
      </div>
    </div>

    <div *ngIf="!loading && gasolinerasFiltradas.length === 0" class="sin-resultados">
      No se encontraron gasolineras.
    </div>
  </div>
</div>
